/*
 * file: SWWP.js
 *
 * @BEGINLICENSE
 * Copyright 2010 Brook Novak  (email : brooknovak@seaweed-editor.com) 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 * @ENDLICENSE
 */
(function(){var B=[],v,a,I=0;(function(){var N=false;swwp={init:function(){if(v){return}v='<img class="swwp-more" src="'+swwpInfo.plugURL+'/css/images/trans.gif" style="background: url('+swwpInfo.plugURL+'/css/images/more.gif) no-repeat right top;padding:0;margin: 15px 2px 2px 2px;border: 0px;border-top: 1px dotted #cccccc;display: block;width: 100%;height: 12px;"/>';L();de.init();de.UndoMan.maxHistoryCount=swwpInfo.undo_history?swwpInfo.undo_history:100;de.cursor.usrGetPlacementFlags=function(Q){if($j(Q).is(".caption,.wp-caption")){return de.cursor.PlacementFlag.BEFORE|de.cursor.PlacementFlag.AFTER}if(Q.nodeName.toLowerCase()=="img"&&$j(Q).parents().is(".caption,.wp-caption")){return 0}};a=!(de.browser==de.Platform.IE&&de.browserVersion&&de.browserVersion<7);de.UndoMan.addObserver({onBeforeExec:function(){de.UndoMan.removeObserver(this);de.Changes.clear();N=true}});window.onbeforeunload=J;de.doc.declarePropertySets({commentContent:{phMarkup:"[Enter comment]",name:"Comment Content",actionFilter:"!ChangeContainer,Itemize"},commentAuthor:{phMarkup:"[Enter name]",singleLine:1,name:"Comment Author",actionFilter:"Format(Link)"},postTitle:{phMarkup:"[Enter post title]",singleLine:1,name:"Post Title",actionFilter:"SpellCorrect,SpellUnmark,SpellMark"},postContent:{name:"Post Content",phMarkup:"[Enter content]"},newTitle:{phMarkup:"[Enter new title]",singleLine:1,name:"New Post/Page Title",actionFilter:"SpellCorrect,SpellUnmark,SpellMark"},newContent:{name:"New Post/Page Content",phMarkup:"[Enter new content]"}});de.visitAllNodes(document.body,document.body,true,function(S){if(de.findClassName(S,/^.+-edit-link$/)){var R=S.firstChild;while(R&&R.nodeType!=3){R=R.firstChild}if(R){var Q=R.nodeValue.toLowerCase().indexOf("edit");if(Q>=0){R.nodeValue=R.nodeValue.substr(0,Q)+"Classic"+de.parseHTMLString("&nbsp;")+R.nodeValue.substr(Q)}}return 1}});for(var P=1;P<=2;P++){for(var O in B){if(P==1){if(B[O]["init"]){B[O]["init"]()}}else{if(B[O]["afterInit"]){B[O]["afterInit"]()}}}}B=null;$j(".sw-combo-item").hover(function(){$j(this).addClass("ui-state-hover")},function(){$j(this).removeClass("ui-state-hover")});K();l($j(".sw-button, .ww-button, .sw-combo, .sw-minmax, .sw-list-item"));de.Typing.addObserver({onTyping:M});if(t()){$j(".swNewPostMeta input, .swNewPostMeta textarea").change(function(){de.Changes.dirty()})}}};function K(){if(swwpInfo.use_notifiers){var P=document.createElement("div");P.className="sw-protect sw-edit-notifier ui-widget-header";P.style.display="none";document.body.appendChild(P);var U=de.doc.getAllEditSections();var R={};for(var Q in U){R[de.findClassName(U[Q],/^editable.*$/)]=true}if(R["editable-postContent"]){delete R["editable-postContent"]}for(var T in R){$j("."+T).hover(function(){var X=de.cursor.getCurrentCursorDesc();if(!X||de.doc.getEditSectionContainer(X.domNode)!=this){$j(this).addClass("es-hover");var V=de.doc.getEditProperties(this),Y=de.getPositionInWindow(this),W=de.getDocumentScrollPos();$j(P).css("display","").html("Edit"+(V.name?" "+V.name:"")).css("left",(Y.x+W.left)+"px").css("top",(Y.y+W.top-P.offsetHeight)+"px")}},function(){$j(this).removeClass("es-hover");$j(P).css("display","none")})}de.cursor.addObserver({onCursorChanged:function(){if(P.style.display!="none"){$j(".es-hover").removeClass("es-hover");$j(P).css("display","none")}}});var O=null;$j(".editable-postContent, .swwp-post-preview").mousemove(function(W){var V=this;S();O=setTimeout(function(){var Z=de.cursor.getCurrentCursorDesc();if((!Z||de.doc.getEditSectionContainer(Z.domNode)!=V)&&$j(".gallery.es-hover").length==0){var Y=$j(V).hasClass("swwp-post-preview")?"(Post Teaser: Navigate to full post content to edit)":("(Click to begin editing "+(de.doc.getEditProperties(V).name||"")+")"),X=de.events.getXYInWindowFromEvent(W),aa=de.getDocumentScrollPos();$j(P).css("display","").html(Y).css("left",(X.x+aa.left+5)+"px").css("top",(X.y+aa.top-P.offsetHeight-10)+"px")}},1000)}).hover(function(){},function(){S();$j(P).css("display","none")});$j(".swwp-shortcode").hover(function(){var X=$j(this).find("object");if(X.length==0){$j(this).addClass("es-hover");X=null}else{X=X.get(0)}var V=de.getDocumentScrollPos(),W=de.getPositionInWindow(X||this);$j(P).css("display","").html($j(this).find(".gallery").length>0?"Edit Gallery":"["+$j(this).attr("title")+"]...").css("left",(W.x+V.left)+"px").css("top",(W.y+V.top-P.offsetHeight)+"px")},function(){$j(this).removeClass("es-hover");$j(P).css("display","none")})}function S(){if(O!==null){clearTimeout(O);O=null}}}function M(P,Q,O){if($j(document.body).children(".ui-widget-overlay:not([display=none])").length>0){P.cancel=true;return}if(de.events.Keyboard.isAcceleratorDown(Q)){switch(O.toLowerCase()){case"s":C.onSave.call(C);P.cancel=true;de.events.consume(Q);return;case"n":C.onNewPost.call(C);P.cancel=true;de.events.consume(Q);return}}}function L(){var V=/\[editable-postTitle-(\d+)-(\d+)\](.*?)\[\/editable-postTitle\]/;de.visitAllNodes(document.body,document.body,true,function(ab){var aa;if(ab.nodeType==1&&ab.id.indexOf("more-")===0&&ab.nodeName.toLowerCase()=="span"&&de.doc.isNodeEditable(ab)){$j(ab).replaceWith(v)}else{if(ab.nodeType==3&&(aa=V.exec(ab.nodeValue))){var X=ab.nodeValue.substr(0,aa.index),Z=ab.nodeValue.substr(aa.index+aa[0].length);var Y=document.createElement("span");$j(Y).addClass("editable-postTitle").attr("id","editable-postTitle-"+aa[1]+"-"+aa[2]).text(aa[3]);$j(ab).replaceWith(Y);$j(Y).before(X);$j(Y).after(Z)}}});var U=[];$j(".swwp-sc-start").each(function(){var Y=/^\s*(\d+)_(.+)$/.exec($j(this).text());if(Y){var Z=$j("#swwp-sc-end-"+Y[1]);if(Z.length==1){if(this.nextSibling&&this.nextSibling.nodeType==3){var X=this.firstChild;while(X&&X.nodeType!=8){X=X.nextSibling}if(X){var aa=X.nodeValue.indexOf("]");if(aa>0&&this.nextSibling.nodeValue.substr(0,aa)==X.nodeValue.substr(0,aa)){$j(this).remove();$j(Z.get(0)).remove();Z=null}}}if(Z){U.push([this,Z.get(0),Y[2]])}}}});for(var S in U){var Q=U[S][0],T=U[S][1];de.recordOperations(false);var W=de.buildFragment(null,Q,0,T,1);W.disconnect();de.recordOperations(true);W.visit(function(X){if(X.isShared&&X!=W){X.node=X.node.cloneNode(false)}});W.visit(function(X){if(X.isShared&&X!=W){for(var Y in X.children){X.node.appendChild(X.children[Y].node)}}});var O=false;for(var R in W.children){if(de.isBlock(W.children[R].node)){O=true;break}}var P=document.createElement(O?"div":"span");$j(P).addClass("sw-packaged").addClass("swwp-shortcode").attr("title",U[S][2]);de.insertAt(W.node,P,W.children[0].pos+(W.children[0].isShared?1:0));for(var R in W.children){P.appendChild(W.children[R].node)}if(Q.nextSibling==T){$j(Q).after("["+U[S][2]+"...]")}}}function J(){if(!I&&N&&de.Changes.getChangedEditableSections().length>0){return"You have unsaved changes on this page."}}})();function l(J){J.hover(function(){if(!$j(this).hasClass("ui-state-disabled")){$j(this).addClass("ui-state-hover")}},function(){if(!$j(this).hasClass("ui-state-disabled")){$j(this).removeClass("ui-state-hover")}}).mousedown(function(){if(!$j(this).hasClass("ui-state-disabled")){$j(this).parents(".sw-buttonset-single:first").find(".sw-button.ui-state-active").removeClass("ui-state-active");if($j(this).is(".ui-state-active .sw-button-toggleable, .sw-buttonset-multi .ui-state-active")){$j(this).removeClass("ui-state-active")}else{$j(this).addClass("ui-state-active")}}}).mouseup(function(){if(!$j(this).hasClass("ui-state-disabled")){if(!$j(this).is(".sw-button-toggleable, .sw-buttonset-single .sw-button, .sw-buttonset-multi .sw-button")){$j(this).removeClass("ui-state-active")}}})}function w(K,J){return'<div id="'+K+'" class="sw-color-select"><a class="sw-colorsel-apply ww-button ui-state-default ui-corner-left"><span class="ww-icon '+J+'"></span><span class="sw-color-preview"></span></a><a class="sw-colorsel-arrow ww-button ui-state-default ui-corner-right"><span class="ui-icon ui-icon-carat-1-s"></span></a></div>'}var o=function(J){var K=[];for(var M in J){var L=J[M];K.push({value:"#"+L})}return K}(["000000","993300","333300","003300","003366","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF9900","99CC00","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFCC","CCFFFF","99CCFF","CC99FF","FFFFFF",]);function f(K,O,J){this.selectNode=K;var Q=this;this.isDefaultSelected=true;var L=new e(function(T,U){if(T=="default"){Q.isDefaultSelected=true;$j(Q.selectNode).find(".sw-color-preview").css("background-color","");J(Q.getSelectedColor())}});this.dropDown=L;$j(L.container).addClass("sw-colorsel-dropdown");L.addItem(null,'<div class="sw-colorsel-title">'+O+"</div>");var N='<table class="sw-colorsel-table">';for(var M=0;M<o.length;M++){if(M%8==0){if(M>0){N+="</tr>"}N+="<tr>"}N+='<td><a class="ww-button ui-state-default"><span class="sw-color-option" style="background-color:'+o[M].value+'"></span></a></td>'}N+"</tr></table>";var S=L.addItem("table",N);L.addItem("default",'<div style="text-align:center;margin-top:6px"><a class="sw-button ui-corner-all ui-state-default" style="float:none">Default</a></div>');var P,R;$j(K).find(".ww-button").each(function(){if($j(this).hasClass("sw-colorsel-arrow")){R=this}else{P=this}});de.events.addHandler(P,"click",function(){if(!$j(P).hasClass("ui-state-disabled")){J(Q.getSelectedColor())}});$j(S).find(".ww-button").mousedown(function(T){Q.isDefaultSelected=false;$j(Q.selectNode).find(".sw-color-preview").css("background-color",$j(this).find("span").css("background-color"));J(Q.getSelectedColor())});de.events.addHandler(R,"click",function(){if(Q.dropDown.isShown()){Q.dropDown.hide()}else{if(!$j(R).hasClass("ui-state-disabled")){Q.showDropDown()}}});de.events.addHandler(window,"resize",function(){Q.positionDropDown()});de.events.addHandler(window,"scroll",function(){Q.positionDropDown()})}f.prototype={getSelectedColor:function(){return this.isDefaultSelected?"default":$j(this.selectNode).find(".sw-color-preview").css("background-color")},positionDropDown:function(){var M=de.getPositionInWindow(this.selectNode),L=de.getDocumentScrollPos(),J=de.getViewPortSize(),K=M.x+L.left;if(de.browser==de.Platform.IE&&de.browserVersion<7){$j(this.dropDown.container).css("width",$j(this.dropDown.container).find("table").attr("offsetWidth"))}if((K+this.dropDown.container.offsetWidth)>J.width){K=J.width-this.dropDown.container.offsetWidth}this.dropDown.container.style.top=(M.y+this.selectNode.offsetHeight+L.top)+"px";this.dropDown.container.style.left=K+"px"},showDropDown:function(){this.dropDown.show();this.positionDropDown()},setEnabled:function(J){if(J){$j(this.selectNode).find(".ww-button").removeClass("ui-state-disabled")}else{$j(this.selectNode).find(".ww-button").addClass("ui-state-disabled")}}};function y(L,K,J){return'<a id="'+L+'" class="sw-combo ui-state-default ui-corner-all" style="width:'+J+'px"><span class="sw-combo-value" style="overflow:hidden;width:'+(J-16)+'px">'+K+'</span><span class="sw-combo-arrow ui-icon ui-icon-carat-1-s"></span></a>'}function F(J,O,Q,N,K){this.button=J;this.items=N;var P=this;var M=new e(function(S){if(S){P.setText($j(P.items[S].node).text());K(S)}});this.dropDown=M;$j(M.container).addClass("sw-combo-dropdown");if(Q){$j(M.container).css(de.browser==de.Platform.IE&&de.browserVersion<7?"height":"max-height",Q).css("overflow-y","scroll");if(de.browser==de.Platform.IE){$j(M.container).css("overflow-x","hidden").css("padding-right","15px")}}M.addItem(null,'<div class="sw-combo-title">'+O+"</div>");for(var R in N){var L=M.addItem(R,'<div class="sw-combo-item ui-state-default">'+N[R].markup+"</div>");L.style.borderStyle="none";N[R].node=L}var P=this;de.events.addHandler(J,"click",function(){if(P.dropDown.isShown()){P.dropDown.hide()}else{if(!$j(P.button).hasClass("ui-state-disabled")){setTimeout(function(){P.showDropDown()},1)}}});de.events.addHandler(window,"resize",function(){P.positionDropDown()});de.events.addHandler(window,"scroll",function(){P.positionDropDown()})}F.prototype={positionDropDown:function(){var K=de.getPositionInWindow(this.button),J=de.getDocumentScrollPos();this.dropDown.container.style.top=(K.y+this.button.offsetHeight+J.top)+"px";this.dropDown.container.style.left=(K.x+J.left)+"px"},showDropDown:function(){this.positionDropDown();this.dropDown.show()},setText:function(J){$j(this.button).find(".sw-combo-value").html(J.replace(/\s/g,"&nbsp;"))}};function s(J,K){this.dropDown=new e(J);$j(this.dropDown.container).addClass("sw-context-menu").removeClass("ui-widget-content");this.fixedWidth=K}s.prototype={show:function(K,J){var L=de.getDocumentScrollPos();$j(this.dropDown.container).css("top",(J+L.top)+"px").css("left",(K+L.left)+"px");this.dropDown.show();if(de.browser==de.Platform.IE){$j(this.dropDown.container).css("width",this.dropDown.container.offsetWidth+"px")}},isShown:function(){return this.dropDown.isShown()},addButton:function(L,J,K){return this.dropDown.addItem(L,'<div class="sw-button ui-state-default"'+(this.fixedWidth?' style="width:'+this.fixedWidth+'px;padding-left:0;padding-right:0;"':"")+">"+J+"</div>",K)},addSeparator:function(){return this.dropDown.addItem(0,'<div class="ui-widget-content" style="height:4px;'+(this.fixedWidth?"width:"+this.fixedWidth+"px;":"")+'"></div>')}};B.push({init:function(){$j.extend(n,new s(n.onClicked));n.build();$j.extend(G,new s(G.onClicked));G.build();$j.extend(k,new s(k.onClicked,200));k.build();$j.extend(E,new s(E.onClicked));E.build();de.events.addHandler(de.engine==de.Platform.GECKO?window:document,"mousedown",function(N){var M=de.events.getEventTarget(N),J;if(de.cursor.isCursorEle(M)){J=de.events.getXYInWindowFromEvent(N);M=de.cursor.getNonCursorNodeAtXY(J.x,J.y)}var L=de.spell.getMarkedAncestor(M);if(L){k.lastClicked=L;k.setState(1);if(!J){J=de.events.getXYInWindowFromEvent(N)}k.show(J.x+4,J.y+4);d.getSuggestions($j(L).text(),function(P){if(k.isShown()){if(!P){k.setState(4)}else{if(P.length==0){k.setState(3)}else{k.setState(2);for(var O in P){k.addSuggestion(P[O])}}}}})}else{if(de.doc.isNodeEditable(M)||de.doc.isEditSection(M)){if(M.nodeName.toLowerCase()=="img"&&!$j(M).parents().is(".gallery")){if(!J){J=de.events.getXYInWindowFromEvent(N)}E.onImageClicked(M,J.x,J.y)}else{var K=M;while(K&&K!=document.body){if(K.nodeName.toLowerCase()=="a"){break}K=K.parentNode}if(K&&K!=document.body&&!$j(K).parents().is(".gallery")){if(de.doc.isNodeEditable(K)){$j(n.editLinkButton).css("display","");$j(n.unlinkButton).css("display","")}else{$j(n.editLinkButton).css("display","none");$j(n.unlinkButton).css("display","none")}if(!J){J=de.events.getXYInWindowFromEvent(N)}n.lastClick={link:K,pos:J};de.selection.clear();n.show(J.x+4,J.y+4)}}}}});de.events.addHandler(de.engine==de.Platform.GECKO?window:document,"click",function(M){var L=de.events.getEventTarget(M),J;if(de.doc.isNodeEditable(L)||de.doc.isEditSection(L)){var K=L;while(K&&K!=document.body&&!$j(K).parents().is(".gallery")){if(K.nodeName.toLowerCase()=="a"){break}K=K.parentNode}if(K&&K!=document.body){return false}}})}});var n={build:function(){var J=this;J.followButton=J.addButton("follow","Follow");J.editContentButton=J.addButton("edit-content","Edit&nbsp;Content");J.editLinkButton=J.addButton("edit-link","Edit&nbsp;Link");J.unlinkButton=J.addButton("unlink","Remove&nbsp;Link")},onClicked:function(K){if(K!="follow"){var J=de.cursor.getCursorDescAtXY(n.lastClick.pos.x,n.lastClick.pos.y);if(J){de.cursor.setCursor(J)}}switch(K){case"follow":window.location=n.lastClick.link.href;break;case"edit-link":j.show();break;case"unlink":if(de.selection.isRangeEditable()){de.UndoMan.execute("Format","link",null)}break}}};var G={build:function(){var J=this;J.followButton=J.addButton("follow","Follow&nbsp;Link");J.editGalleryButton=J.addButton("edit","Edit&nbsp;Gallery");J.deleteGalleryButton=J.addButton("remove","Remove&nbsp;Gallery");$j(".gallery").add(".gallery a").click(J.onGalleryClick)},onGalleryClick:function(L){var K=de.events.getEventTarget(L),J=de.events.getXYInWindowFromEvent(L);if(!$j(K).parents().is(".gallery")){return}$j(G.followButton).css("display",($j(K).parents().andSelf().is("a"))?"":"none");G.lastClick=K;G.show(J.x+4,J.y+4);return de.events.consume(L)},onClicked:function(N){if(G.lastClick){switch(N){case"follow":var J=$j(G.lastClick).parents().andSelf().filter("a").attr("href");if(J){window.location=J}break;case"edit":var K=de.doc.getEditSectionContainer(G.lastClick);if(K){de.selection.selectES(K,false);h.show("gallery")}break;case"remove":var M=$j(G.lastClick).parents().andSelf().filter(".sw-packaged");var L=M.length>0?M.get(0):0;if(L&&$j(L).find(".gallery, .swwp-gallery")==0){L=0}if(L&&de.doc.isNodeEditable(L)){var K=de.doc.getEditSectionContainer(G.lastClick);de.UndoMan.execute("RemoveNode",L);if(K){de.selection.selectES(K,true)}}break}}}};var E={build:function(){var J=this;J.followButton=J.addButton("follow","Follow&nbsp;Link");J.editImageButton=J.addButton("edit","Edit&nbsp;Image");J.deleteImageButton=J.addButton("remove","Remove&nbsp;Image")},onImageClicked:function(K,J,L){$j(E.followButton).css("display",($j(K).parents().andSelf().is("a"))?"":"none");E.lastClick=K;E.show(J+4,L+4)},onClicked:function(M){if(E.lastClick){switch(M){case"follow":var J=$j(E.lastClick).parents().andSelf().filter("a").attr("href");if(J){window.location=J}break;case"edit":x.show(E.lastClick);break;case"remove":var L=$j(E.lastClick).parents().filter(".caption,.wp-caption"),K=E.lastClick;if(L.length>0){K=L.get(0)}if(K){de.UndoMan.execute("RemoveNode",K)}break}}}};var k={build:function(){var J=this;J.pendingMessage=J.dropDown.addItem(0,'<div class="ui-widget-header" style="text-align:center">Retrieving...<br/><img src="'+swwpInfo.plugURL+'/css/images/ajax.gif" width="'+J.fixedWidth+'"/></div>');J.suggestMessage=J.dropDown.addItem(0,'<div class="ui-widget-header" style="text-align:center">.</div>');J.separator=J.addSeparator();J.addButton("ignore","Ignore Spelling");J.addButton("ignorealways","Always Ignore Spelling")},addSuggestion:function(J){l($j(this.addButton("fix:"+J,J,this.separator)))},setState:function(M){var L=this;L.pendingMessage.style.display="none";L.suggestMessage.style.display="none";if(M==1){L.pendingMessage.style.display=""}else{$j(L.suggestMessage).css("display","").text(M==2?"Suggestions:":(M==3?"No Suggestions":"Failed to get suggestions"))}var K=L.suggestMessage.nextSibling;while(K!=L.separator){var J=K;K=K.nextSibling;J.parentNode.removeChild(J)}},onClicked:function(L){if(L&&/^fix:.+$/.test(L)){de.spell.correctError(k.lastClicked,L.substr(4))}else{if(L=="ignore"){de.spell.ignoreError(k.lastClicked)}else{if(L=="ignorealways"){var K=$j(k.lastClicked).text(),J=0;$j(".sw-spell-error:contains('"+K+"')").each(function(){de.spell.ignoreError(this,J?de.UndoMan.ExecFlag.GROUP:0);J=1});d.ignoreWords[K]=1}}}}};var C={failedSaves:0,isDocked:1,init:function(){var L=document.createElement("div");L.id="swControlPanel";this.rootPane=L;var K='<div class="sw-dialog-title ui-widget-header ui-corner-all ui-helper-clearfix">';K+='<a id="cpanMinMax" class="swwp-dialog-button ui-corner-all"><span class="ui-icon ui-icon-carat-1-s">Minimize</span></a>';K+='<a id="cpanDock" class="swwp-dialog-button ui-corner-all"><span class="ui-icon ui-icon-pin-w">Undock</span></a>';K+='<span class="ui-dialog-title">~Seaweed~ control panel</span>';K+="</div>";K+='<div id="swControlPanelContent">';K+='<div id="swSaveProgress" style="padding:10px;display:none">';K+='<p style="text-align:center;font-size:small;font-wight:bold"><span></span><br/>';K+='<img src="'+swwpInfo.plugURL+'/css/images/ajax.gif" ></p>';K+="</div>";K+='<div id="swSaveComplete" class="ui-widget-content" style="display:none;position:absolute;z-index:10;">';K+='<p style="text-align:center;font-weight:bold"></p>';K+="</div>";K+="<table><tbody><tr><td>";J("swSave","Save"+(t()?"&nbsp;Draft":"&nbsp;..."));K+="</td><td>";if(!t()){J("swNewPost","New&nbsp;Post");K+="</td><td>"}J("swDelete",t()?"Cancel Draft":("Delete&nbsp;"+(swwpInfo.view.indexOf("page")!=-1?"Page":"Post")),!t()&&($j(".editable-postContent").length==0||!p()));K+="</td></tr><tr><td>";J("swSaveAllPublish",t()?"Publish":"Quick&nbsp;Save");K+="</td><td>";if(!t()){J("swNewPage","New&nbsp;Page");K+="</td><td>"}J("swViewToolbox","Show&nbsp;ToolBox");K+="</td></tr></tbody></table>";K+="</div>";L.innerHTML=K;document.body.appendChild(L);$j(L).addClass("sw-protect").addClass("ui-widget").addClass("ui-widget-content").addClass("ui-corner-all").css({position:a?"fixed":"absolute","z-index":"100",opacity:swwpInfo.cp_op});$j("#swControlPanel button").bind("click",function(N){var M=de.events.getEventTarget(N);if($j("#"+M.id).hasClass("ui-state-disabled")){return}C["on"+M.id.substr(2)]()});$j("#cpanMinMax").bind("click",function(M){C.setExpansion(!C.isExpanded())});de.events.addHandler(window,"resize",function(){if(C.isDocked){C.repositionPanel()}});if(!a){de.events.addHandler(window,"scroll",function(){if(C.isDocked){C.repositionPanel()}})}if(de.browser==de.Platform.IE){L.style.width=$j(L).find("table").attr("offsetWidth")}this.contentHeight=document.getElementById("swControlPanelContent").offsetHeight;this.setExpansion(swwpInfo.cp_se,true);$j("#cpanDock").bind("click",function(M){C.setDockState(!C.isDocked)});this.setDockState(1,1);this.repositionPanel();if(!swwpInfo.cp_se){de.UndoMan.addObserver({onBeforeExec:function(){C.setExpansion(true);de.UndoMan.removeObserver(this)}})}de.UndoMan.addObserver({onAfterExec:function(){C.updateSaveButtons(1)},onAfterUndo:function(){C.updateSaveButtons()},onAfterRedo:function(){C.updateSaveButtons()}});this.updateSaveButtons();function J(O,N,M){K+='<button id="'+O+'" title="'+N+'" class="sw-button ui-state-default '+(M?"ui-state-disabled":"ui-priority-primary")+' ui-corner-all">'+N+"</button>"}},afterInit:function(){m.addObserver({onToolboxOpenStateChanged:function(K){J(K)}});function J(K){$j("#swViewToolbox").html((K?"Hide":"Show")+"&nbsp;ToolBox")}g.addObserver({onSave:function(){if(!this.isExpanded()){this.setExpansion(true)}this.updateGUI()},onSaveSucceeded:function(){this.updateGUI(true)},onSaveFailed:function(K,L){alert("Failed to save item\n"+L);this.failedSaves++;this.updateGUI(true)}},this);J(m.isVisible())},updateSaveButtons:function(J){if(!t()){if(typeof J=="undefined"){J=de.Changes.getChangedEditableSections().length>0}if(J){$j("#swSave, #swSaveAllPublish").addClass("ui-priority-primary").removeClass("ui-state-disabled")}else{$j("#swSave, #swSaveAllPublish").addClass("ui-state-disabled").removeClass("ui-priority-primary")}}},updateGUI:function(K){var J=g.itemsPending.length;if(J){$j(this.rootPane).find("table").css("display","none");$j("#swSaveProgress").css("display","").find("p span").text(t()?"Saving Draft":"Saving "+(J+" item"+(J>1?"s":""))+"...")}else{$j(this.rootPane).find("table").css("display","");$j("#swSaveProgress").css("display","none");if(K){$j("#swSaveComplete").find("p").text(this.failedSaves?"Failed to save "+this.failedSaves+" item"+(this.failedSaves>1?"s":""):"Save(s) completed successfully").css("color",this.failedSaves?"red":"green");if(this.failedSaves){$j("#swSaveComplete").addClass("ui-state-error")}else{$j("#swSaveComplete").removeClass("ui-state-error")}this.failedSaves=0;$j("#swSaveComplete").css("width",$j(this.rootPane).find("table").attr("offsetWidth")+"px").css("height",$j(this.rootPane).find("table").attr("offsetHeight")+"px").css("display","");setTimeout(function(){if($j("#swSaveComplete").css("display")!="none"){$j("#swSaveComplete").fadeOut(1000)}},1000)}}this.updateSaveButtons();if(C.isDocked){C.repositionPanel()}},repositionPanel:function(){var J=de.getViewPortSize(1),K=de.getDocumentScrollPos();var L=this.calculateDockPosition();$j(this.rootPane).css("top",L.y+"px").css("left",L.x+"px")},calculateDockPosition:function(){var J=de.getViewPortSize(1),K=de.getDocumentScrollPos();return{y:((J.height-this.rootPane.offsetHeight)+(a?0:K.top)),x:(((J.width/2)-(this.rootPane.offsetWidth/2))+(a?0:K.left))}},setExpansion:function(M,J){var L=false;if(M){$j("#cpanMinMax").children().removeClass("ui-icon-carat-1-n").addClass("ui-icon-carat-1-s").text("Minimize");$j("#cpanMinMax").attr("title","Minimize control panel");if(J){$j("#swControlPanelContent").css("height",C.contentHeight+"px")}else{$j("#swControlPanelContent").animate({height:C.contentHeight+"px"},200,"linear",function(){L=true})}}else{this.setDockState(1,1);$j("#cpanMinMax").children().removeClass("ui-icon-carat-1-s").addClass("ui-icon-carat-1-n").text("Maximize");$j("#cpanMinMax").attr("title","Maximize control panel");if(J){$j("#swControlPanelContent").css("height","0px")}else{$j("#swControlPanelContent").animate({height:"0px"},500,"linear",function(){L=true})}}if(!J){setTimeout(function K(){C.repositionPanel();if(!L){setTimeout(K,50)}},50)}},isExpanded:function(){return $j("#cpanMinMax").children().hasClass(".ui-icon-carat-1-s")},setDockState:function(K,J){this.isDocked=K;if(K){$j(this.rootPane).draggable("destroy");$j("#cpanDock").attr("title","Un-dock control panel").children().removeClass("ui-icon-pin-s").addClass("ui-icon-pin-w")}else{$j(this.rootPane).draggable({cancel:"button,a,td,table"});$j("#cpanDock").attr("title","Dock control panel").children().removeClass("ui-icon-pin-w").addClass("ui-icon-pin-s")}if(!J){if(K){var L=this.calculateDockPosition();$j(this.rootPane).animate({top:L.y+"px",left:L.x+"px"},100,"linear")}else{if(!this.isExpanded()){this.setExpansion(1,1)}var L=this.calculateDockPosition();$j(this.rootPane).animate({top:(L.y-10)+"px",left:(L.x+10)+"px"},50,"linear")}}},onSave:function(){if(t()){g.saveNewPost(false)}else{A.show()}},onNewPost:function(){if(!t()){window.location.href=swwpInfo.plugURL+"/php/new-post.php?newtype=post&nonce="+swwpInfo.nonce}},onNewPage:function(){if(!t()){window.location.href=swwpInfo.plugURL+"/php/new-post.php?newtype=page&nonce="+swwpInfo.nonce}},onSaveAllPublish:function(){if(t()){g.saveNewPost(true)}else{var J=de.Changes.getChangedEditableSections();if(J.length>0){g.saveExisting(J)}}},onDelete:function(){g.deletePost()},onViewToolbox:function(){m.setVisible(!m.isVisible())}};B.push(C);var A={init:function(){var J=document.createElement("div");this.dialogContent=J;document.body.appendChild(J);$j(J).dialog({title:"~Seaweed~ Save ...",resizable:false,autoOpen:false,width:500,minHeight:0,modal:true,buttons:{"Save Selected":function(){A.save(0);$j(this).dialog("close")},"Save All":function(){A.save(1);$j(this).dialog("close")},Cancel:function(){$j(this).dialog("close")}}});$j(J.parentNode).addClass("sw-protect")},save:function(J){var K=[];$j(this.dialogContent).find(".sw-list-item").each(function(){if(J||$j(this).find("input").attr("checked")){K.push(A.items[parseInt(this.id.substr(this.id.indexOf("-")+1))].es)}});if(K.length>0){g.saveExisting(K)}},show:function(){var N=de.Changes.getChangedEditableSections();if(N.length==0){return false}this.items=[];var M='<div style="border:solid 1px #CCCCCC">';for(var K in N){var J=N[K];var O=de.doc.getEditProperties(J);L(O.name||"Unknown",J)}M+="</div>";$j(this.dialogContent).html(M).dialog("open").find(".sw-list-item").hover(function(){$j(this).addClass("ui-state-hover")},function(){$j(this).removeClass("ui-state-hover")}).click(function(R){var Q=de.events.getEventTarget(R),P;if(Q.nodeName.toLowerCase()=="input"){P=Q.checked?true:false}else{P=!$(this).hasClass("ui-state-active")}if(P){$j(this).addClass("ui-state-active").find("input").attr("checked","checked")}else{$j(this).removeClass("ui-state-active").find("input").removeAttr("checked")}});function L(R,P){var Q="<strong>*"+R+'</strong> - <em style="font-weight:normal;color:#777777">'+$j(P).text().substr(0,20)+"...</em>";M+='<div id="swSaveLI-'+A.items.length+'" class="sw-list-item ui-state-default ui-state-active" style="padding:4px;'+(A.items.length>0?";border-top:dashed 1px #CCCCCC":"")+'"><div style="float:right"><input type="checkbox" checked="checked" /></div>'+Q+"</div>";A.items.push({name:R,es:P})}}};var j={init:function(){var J=document.createElement("div");J.id="swLinkDialogContent";document.body.appendChild(J);this.dialogContent=J;J.innerHTML='<table class="sw-link-table"><tr><td>URL:</td><td><input class="sw-link-input" id="swLinkURLInput" type="text" autocomplete="off" /></td></tr><tr><td>Title:</td><td><input class="sw-link-input" id="swLinkTitleInput" type="text" /></td></tr></table>';this.urlInput=document.getElementById("swLinkURLInput");this.titleInput=document.getElementById("swLinkTitleInput");$j("#swLinkDialogContent").dialog({title:"~Seaweed~ Edit Link",resizable:false,autoOpen:false,minHeight:0,width:390,modal:true,buttons:{Ok:function(){var L=$j(j.urlInput).val();L=L.replace(/^\s*/,"").replace(/\s*$/,"");if(L&&!/^.+:\/\/.+$/.test(L)){if(/^www\..+/.test(L)||/.+\.(com|net|org|info|uk|au|ca|nz|eu|us|jp|ie|cn)(\/.*)?$/.test(L)){if(confirm('The URL provided appers to be an external link, do you want to prepend "http://" ? (If not then the link will not be externally linked)')){L="http://"+L}}}var K=j.selBefore;de.selection.setSelection(K.startNode,K.startIndex,K.endNode,K.endIndex);if(de.selection.isRangeEditable()){de.UndoMan.execute("Format","link",{url:L,title:$j(j.titleInput).val()})}$j(this).dialog("close")},Cancel:function(){$j(this).dialog("close")}}});$j(J.parentNode).addClass("sw-protect")},show:function(){var M=de.selection.getRange(true),K=null;if(!M){return false}if(M.endNode){var J=de.getCommonAncestor(M.startNode,M.endNode,false);de.visitAllNodes(J,M.startNode,true,function(N){L(N);return N!=M.endNode&&K!==0})}else{L(M.startNode)}$j(this.urlInput).val(K?K.href:"");$j(this.titleInput).val(K?K.title:"");this.selBefore=de.selection.getRange(false);de.selection.clear();$j(this.dialogContent).dialog("option","title","~Seaweed~ "+(K?"Edit":"Insert")+" link").dialog("open");function L(N){while(N&&N!=document.body&&de.doc.isNodeEditable(N)){if(N.nodeType==1&&N.nodeName.toLowerCase()=="a"){if(K===null){K=N}else{if(K!=N){K=0}}return}N=N.parentNode}K=0}}};var x={init:function(){var J=document.createElement("div");J.id="swImageDialogContent";document.body.appendChild(J);this.dialogContent=J;J.innerHTML='<table><tr><td>URL<span style="color:red">*</span>:</td><td><input id="swwpImageURLInput" type="text" class="sw-image-input" autocomplete="off" /></td></tr><tr><td>Title<span style="color:red">*</span>:</td><td><input id="swwpImageTitleInput" type="text" class="sw-image-input" autocomplete="off" /></td></tr><tr><td>Caption:</td><td><input id="swwpImageCaptionInput" type="text" class="sw-image-input" autocomplete="off" /></td></tr><tr><td>Alignment:</td><td><input type="radio" name="swwpImgAlign" id="swwpImgAlignnone" value="none"/><label for="swwpImgAlignnone">None</label> | <input type="radio" name="swwpImgAlign" id="swwpImgAlignleft" value="left"/><label for="swwpImgAlignleft">Left</label> | <input type="radio" name="swwpImgAlign" id="swwpImgAligncenter" value="center"/><label for="swwpImgAligncenter">Center</label> | <input type="radio" name="swwpImgAlign" id="swwpImgAlignright" value="right"/><label for="swwpImgAlignright">Right</label></td></tr><tr><td>Size<span style="color:red">*</span>:</td><td>Width: <input id="swwpImageWidthInput" type="text" style="width:60px" /> Height: <input id="swwpImageHeightInput" type="text" style="width:60px" />(px)</td></tr><tr><td>Link image to:</td><td><input id="swwpImageLinkToInput" type="text" class="sw-image-input" autocomplete="off" /></td></tr></table>';$j("#swImageDialogContent").dialog({title:"~Seaweed~ Edit Image",resizable:false,autoOpen:false,minHeight:0,width:460,modal:true,buttons:{Ok:function(){var M=$j("#swwpImageURLInput").val();M=M.replace(/^\s*/,"").replace(/\s*$/,"");if(M&&!/^.+:\/\/.+$/.test(M)){if(/^www\..+/.test(M)||/.+\.(com|net|org|info|uk|au|ca|nz|eu|us|jp|ie|cn)(\/.*)?$/.test(M)){if(confirm('The URL provided appers to be an external link, do you want to prepend "http://" ? (If not then the link will not be externally linked)')){M="http://"+M}}}else{if(!M){alert("Must supply URL to image's source");return}}var P=$j("#swwpImageLinkToInput").val();P=P.replace(/^\s*/,"").replace(/\s*$/,"");if(P&&!/^.+:\/\/.+$/.test(P)){if(/^www\..+/.test(P)||/.+\.(com|net|org|info|uk|au|ca|nz|eu|us|jp|ie|cn)(\/.*)?$/.test(P)){if(confirm('The Link-to URL provided appers to be an external link, do you want to prepend "http://" ? (If not then the link will not be externally linked)')){P="http://"+P}}}var V=$j("#swwpImageTitleInput").val(),Y=$j("#swwpImageCaptionInput").val();if(!V){alert("Must supply title for image");return}var U="none";if($j("#swwpImgAlignleft").attr("checked")){U="left"}else{if($j("#swwpImgAligncenter").attr("checked")){U="center"}else{if($j("#swwpImgAlignright").attr("checked")){U="right"}}}var N=$j("#swwpImageWidthInput").val(),X=$j("#swwpImageHeightInput").val();if(N){N=N.replace(" ","");N=N.replace("px","")}if(X){X=X.replace(" ","");X=X.replace("px","")}function L(Z){return Z&&/^\d+$/.test(Z)}if(!L(N)||!L(X)){alert("Must supply image width and height in pixels");return}var T;if(Y){T='<div class="wp-caption align'+U+'" style="width:'+(parseInt(N)+10)+'px" >';if(P){T+='<a href="'+P+'">'}T+='<img alt="'+Y+'" src="'+M+'" title="'+V+'" width="'+N+'" height="'+X+'"/>';if(P){T+="</a>"}T+='<p class="wp-caption-text">'+Y+"</p>";T+="</div>"}else{T='<img class="align'+U+'" src="'+M+'" title="'+V+'" width="'+N+'" height="'+X+'"/>';if(P){T='<a href="'+P+'">'+T+"</a>"}}var Q=$j(x.selectedImage).parents().filter(".caption,.wp-caption"),O,R,W;if(Q.length>0){O=R=Q.get(0);W=0;if(!Y){T="<p>"+T+"<p>"}}else{var S=$j(x.selectedImage).parents().filter("p,pre,h1,h2,h3,h4,h5,h6");if(S.length){var K=S.get(0);if(/^[\r\n ]*$/.test($j(K).text())){O=R=K;W=0;if(!Y){T="<p>"+T+"<p>"}}else{if(Y){O=x.selectedImage;R=K;W=1}else{O=R=x.selectedImage;W=0}}}else{if(!Y){T="<p>"+T+"<p>"}O=R=x.selectedImage;W=0}}de.UndoMan.execute("InsertHTML",T,R.parentNode,R,W);de.UndoMan.execute(de.UndoMan.ExecFlag.GROUP,"RemoveNode",O);$j(this).dialog("close")},Cancel:function(){$j(this).dialog("close")}}});$j(J.parentNode).addClass("sw-protect")},show:function(N){if(!de.doc.isNodeEditable(N)){return}this.selectedImage=N;$j("#swwpImageURLInput").val(N.src);$j("#swwpImageTitleInput").val(N.title);var P=$j(N).parents().filter(".caption,.wp-caption"),K=0,O;if(P.length>0){K=O=P.get(0);$j("#swwpImageCaptionInput").val($j(K).text())}else{O=N}var Q="none";if(O.className){var L=/align(none|left|center|right)/.exec(O.className);if(L){Q=L[1]}}$j("#swwpImgAlign"+Q).attr("checked","checked");var M=$j(N).css("width"),L;if(M&&(L=/^(\d+)px$/.exec(M))){M=L[1]}else{M=N.offsetWidth}var J=$j(N).css("height");if(J&&(L=/^(\d+)px$/.exec(J))){J=L[1]}else{J=N.offsetHeight}$j("#swwpImageWidthInput").val(M);$j("#swwpImageHeightInput").val(J);if(N.parentNode.nodeName.toLowerCase()=="a"){$j("#swwpImageLinkToInput").val(N.parentNode.href)}$j(this.dialogContent).dialog("open")}};var q={init:function(){var J=document.createElement("div");document.body.appendChild(J);this.dialogContent=J;J.innerHTML="<strong>.</strong>";$j(J).dialog({title:"~Seaweed~ Confirmation",resizable:false,autoOpen:false,modal:true,buttons:{Yes:function(){$j(this).dialog("close");q.onConfirmed()},Cancel:function(){$j(this).dialog("close")}}})},show:function(K,J){this.onConfirmed=J;$j(this.dialogContent).find("strong").html(K);$j(this.dialogContent).dialog("open")}};var H={init:function(){var J=document.createElement("div");document.body.appendChild(J);this.dialogContent=J;J.innerHTML='<span id="swwpNotifyContent">.</span>';$j(J).dialog({resizable:false,autoOpen:false,modal:true,buttons:{Ok:function(){$j(this).dialog("close")}}})},show:function(K,J){if(!K){K="~Seaweed~"}$j("#swwpNotifyContent").html(J);$j(this.dialogContent).dialog("option","title",K).dialog("open")}};var r={show:function(L,K){var M=document.createElement("div");document.body.appendChild(M);$j(M).addClass("sw-protect").addClass("ui-widget-content").addClass("ui-corner-all").addClass("sw-progress-dialog").html('<p style="text-align:center"><strong>'+L+'</strong></p><p style="text-align:center"><img src="'+swwpInfo.plugURL+'/css/images/ajax.gif" ></p>'+(K?'<p style="text-align:center"><em>'+K+"</em></p>":""));this.contentPane=M;var J=document.createElement("div");document.body.appendChild(J);$j(J).addClass("ui-widget-overlay").addClass("sw-protect").css("z-index","1009").css("position",a?"fixed":"absolute").css("top","0px").css("left","0px");this.overlay=J;this.reposition();de.events.addHandler(window,"resize",this.reposition)},error:function(J){$j(this.contentPane).addClass("ui-state-error").html('<p style="text-align:center"><strong>Error: '+J+'</strong></p><p style="text-align:center"><button class="sw-button ui-state-default ui-priority-primary ui-corner-all">Ok</button></p>');l($j(this.contentPane).find("button").click(this.hide));this.reposition()},hide:function(){$j(r.contentPane).remove();$j(r.overlay).remove();de.events.removeHandler(window,"resize",r.reposition);r.contentPane=null;r.overlay=null},reposition:function(){var J=de.getViewPortSize(1),K=de.getDocumentScrollPos();$j(r.contentPane).css("top",((J.height/2)-(r.contentPane.offsetHeight/2))+"px").css("left",((J.width/2)-(r.contentPane.offsetWidth/2))+"px");$j(r.overlay).css("width",J.width+"px").css("height",J.height+"px");if(!a){$j(r.overlay).css("top",K.top+"px").css("left",K.left+"px")}}};B.push(A);B.push(j);B.push(q);B.push(H);B.push(x);function e(J){if(typeof autoHide=="undefined"){autoHide=true}var M=document.createElement("div");this.container=M;this.onItemClick=J;M.className="sw-protect sw-dropdown ui-corner-all ui-widget-content";M.style.display="none";document.body.appendChild(M);var K=this;var L=de.Platform.engine==de.Platform.GECKO?window:document;de.events.addHandler(L,"mousedown",function(O){var N=de.events.getEventTarget(O);if(N!=K.container){K.hide()}})}e.prototype={addItem:function(O,J,M){var L=document.createElement("div");L.innerHTML=J;var P=L.firstChild;var K=L.firstChild;L.removeChild(K);if(M){this.container.insertBefore(K,M)}else{this.container.appendChild(K)}var N=this;$j(P).mousedown(function(Q){if(N.onItemClick){N.onItemClick(O,Q)}N.hide();return de.events.consume(Q)});return P},show:function(){$j(this.container).find(".ui-state-hover, .ui-state-active").removeClass("ui-state-hover").removeClass("ui-state-active");$j(this.container).css("display","")},hide:function(){$j(this.container).css("display","none")},isShown:function(){return $j(this.container).css("display")!="none"}};send_to_editor=function(K){if(!K){return}var L=z(K);var J=document.createElement("div"),P=false;J.innerHTML=L;$j(J).each(function(){if(de.isBlock(this)){P=true;return false}});de.selection.setSelection(h.selBefore.startNode,h.selBefore.startIndex,h.selBefore.endNode,h.selBefore.endIndex);var M=de.selection.getRange(true);if(M){if(!P){L="<p>"+L+"</p>"}var O=M.endNode?M.endNode:M.startNode;var N=de.doc.getEditSectionContainer(O);while(O&&O.parentNode!=N){O=O.parentNode}if(O){de.UndoMan.execute("InsertHTML",L,N,O,O.nodeType==3?O.nodeValue.length:1)}$j(".swwp-gallery").unbind("click").click(G.onGalleryClick)}h.close()};var h={show:function(Q){this.close();this.selBefore=de.selection.getRange(false);if(!this.selBefore){return false}var L=de.cursor.getCurrentCursorDesc();if(!L){return false}var N=de.doc.getEditSectionContainer(L.domNode);if(!N){return false}var O=t()?swwpInfo.tempID:i(N);if(O===null){return false}this.postID=O;de.selection.clear();var M=document.createElement("div");this.contentPane=M;M.innerHTML='<iframe src="'+swwpInfo.siteURL+"/wp-admin/media-upload.php?post_id="+O+(Q=="gallery"?"&tab=":"&type=")+Q+'" frameborder="0" hspace="0" />';document.body.appendChild(M);var K=M.firstChild;$j(M).dialog({title:"~Seaweed~ "+(Q=="gallery"?"Edit":"Upload")+"/Add "+Q,width:670,height:400,resizable:false,draggable:true,modal:true,autoOpen:true,minHeight:0});$j(M).css("padding","0 0 0 0");var R=document.createElement("div");$j(R).css("width","1px").css("height","1px").css("float","right");M.appendChild(R);var J=(R.offsetLeft+1)-K.offsetLeft;M.removeChild(R);$j(K).css("width",J+"px").css("height",(M.offsetHeight-8)+"px");var P=M.parentNode;$j(P).addClass("sw-protect")},close:function(){if(this.contentPane){$j(this.contentPane).dialog("destroy");$j(this.contentPane).remove();this.contentPane=null}}};function z(K){var O,L=/\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\][\s\u00a0]*/g,N=/\[gallery([^\]]*)\]/g;while(O=L.exec(K)){var P=O[1].replace(/\\'|\\&#39;|\\&#039;/g,"&#39;").replace(/\\"|\\&quot;/g,"&quot;"),M=O[2].replace(/\\&#39;|\\&#039;/g,"&#39;").replace(/\\&quot;/g,"&quot;");var J=P.match(/id=['"]([^'"]+)/i),S=P.match(/align=['"]([^'"]+)/i),Q=P.match(/width=['"]([0-9]+)/),R=P.match(/caption=['"]([^'"]+)/i);J=(J&&J[1])?J[1]:"";S=(S&&S[1])?S[1]:"alignnone";Q=(Q&&Q[1])?Q[1]:"";R=(R&&R[1])?R[1]:"";if(Q&&R){M="<div "+(J!==""?'id="'+J+'" ':"")+'class="wp-caption '+S+'" style="width:'+(10+parseInt(Q))+'px">'+M+'<p class="wp-caption-text">'+R+"</p></div>"}K=K.substr(0,O.index)+M+K.substr(L.lastIndex)}while(O=N.exec(K)){K=K.substr(0,O.index)+'<img class="swwp-gallery sw-packaged" title=\'gallery '+O[1]+"' src=\""+swwpInfo.plugURL+'/css/images/trans.gif"/>'+K.substr(N.lastIndex)}return K}var d=function(){function J(M,K,N,L){$j.ajax({type:"POST",url:swwpInfo.plugURL+"/php/ajax-action.php",data:$j.extend({_ajax_nonce:swwpInfo.nonce,action:M},K),success:N,error:L})}return{ignoreWords:{},getSuggestions:function(K,L){J("spellsuggest",{word:K},function(O){var N=wpAjax.parseAjaxResponse(O,O.response,O.element);if(N){for(var M in N.responses){var P=N.responses[M];if(P.what=="error"){L();return}else{if(P.what=="suggestions"){L(P.data.split(" "));return}else{if(P.what=="nosuggestions"){L([]);return}}}}}L()},function(){L()})},markErrors:function(K){var L=de.spell.getWords(K),N=[];for(var M in L){if(!this.ignoreWords[L[M]]){N.push(L[M])}}if(N.length>0){r.show("Spell Checking...");J("spellcheck",{words:N.join(" ")},function(R){var P=wpAjax.parseAjaxResponse(R,R.response,R.element),Q;if(P){for(var O in P.responses){var S=P.responses[O];if(S.what=="error"){Q=S.data;break}else{if(S.what=="mistakes"){de.spell.markWords(S.data,K)}}}}else{Q="Internal server error: "+R}if(Q){r.error(Q)}else{r.hide()}},function(O){r.error("Failed to communicate with server")})}}}}();var u=function(L){var K={};for(var J in L){var M=J.toLowerCase()+(L[J]?", "+L[J]:"");K[J.replace(/\s/g,"")]={name:J,markup:'<span style="font-family:'+M+';font-weight:normal;">'+J.replace(/\s/g,"&nbsp;")+"</span>",value:M}}return K}({"Andale Mono":"times",Arial:"helvetica, sans-serif","Arial Black":"arial black,avant garde","Book Antiqua":"palatino","Comic Sans MS":"sans-serif","Courier New":"courier",Georgia:"palatino",Helvetica:null,Impact:"chicago",Symbol:null,Tahoma:"arial,helvetica,sans-serif",Terminal:"monaco","Times New Roman":"times","Trebuchet MS":"geneva",Verdana:"geneva"});var c=function(L){var K={};for(var J in L){K[J]={name:L[J],markup:"<"+J+">"+L[J].replace(/\s/g,"&nbsp;")+"</"+J+">",value:J}}return K}({p:"Paragraph",address:"Address",pre:"Preformatted",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"});var D=function(L){var J={};for(var K in L){J[K.replace(/[^a-zA-Z0-9]/g,"")]={markup:'<span style="font-size:'+L[K]+';font-weight:normal;">'+K.replace(/\s/g,"&nbsp;")+"</span>",value:L[K]}}return J}({"XX-Small (8pt)":"xx-small","X-Small":"x-small","Small (10pt)":"small","Medium (12pt)":"medium","Large (14pt)":"large","X-Large (18pt)":"x-large","XX-Large (24pt)":"xx-large","36pt":"36pt",Smaller:"smaller",Larger:"larger"});function b(){var J=de.cursor.getCurrentCursorDesc().domNode;while(J&&J!=document.body){if(J.nodeType==1&&J.nodeName.toLowerCase()=="li"){return 1}J=J.parentNode}}var m={yOffset:0,xOffset:0,execActionData:0,lastSynchEditable:0,init:function(){de.model(this);de.events.addHandler(window,"resize",function(){m.repositionPanel()});if(!a){de.events.addHandler(window,"scroll",function(){m.repositionPanel()})}var O=document.createElement("div");O.id="swToolboxContent";var K='<div style="width:100%">';J();L("undo","all");L("redo","all");P();N();J();L("bold","left");L("italic");L("underline");L("strikethrough","right");P();N();J();L("justifyleft","left","Align Left");L("justifycenter","center","Align Center");L("justifyright","right","Align Right");L("justifyfull","justify","Justify");P();N();J();L("bullist","all","Create/Destroy Bullets");L("numlist","all","Create/Destroy Numbers");P();N();J();L("indent","all");L("outdent","all");P();N();J();L("link","all","Create/Edit Link");L("unlink","all","Destroy Link");L("blockquote","all","Create/Destroy Block Quote");L("pagebreak","all","Insert Page-break");P();N();J();L("spell","all","Spell check");P();K+='<span style="clear:both"></span>';J();K+=y("swFormat","Format",98);K+=y("swFontFamily","Font&nbsp;Family",98);K+=y("swFontSize","Font&nbsp;Size",98);P();N();J();K+=w("swForeColor","ww-icon-forecolor");K+=w("swBackColor","ww-icon-backcolor");P();N();J();L("wpimage","all","Add Image");L("wpvideo","all","Add Video");L("wpaudio","all","Add Audio");P();K+="</div>";K+='<div style="clear:both;padding:4px;"></div>';K+='<div class="sw-edit-context-container ui-widget-content">Edit-Location:<span id="swEditContext">&nbsp;</span></div>';O.innerHTML=K;document.body.appendChild(O);this.formatCombo=new F(document.getElementById("swFormat"),"Format","100px",c,function(Q){de.UndoMan.execute("ChangeContainer",c[Q].value)});this.fontFamilyCombo=new F(document.getElementById("swFontFamily"),"Font&nbsp;Family","100px",u,function(Q){de.UndoMan.execute("Format","fontfamily",u[Q].value)});this.fontSizeCombo=new F(document.getElementById("swFontSize"),"Font&nbsp;Size","100px",D,function(Q){de.UndoMan.execute("Format","fontsize",D[Q].value)});this.foreColorCombo=new f(document.getElementById("swForeColor"),"Forecolor",function(Q){de.UndoMan.execute("Format","color",Q=="default"?null:Q);de.cursor.setCursor(de.cursor.getCurrentCursorDesc())});this.backColorCombo=new f(document.getElementById("swBackColor"),"Backcolor",function(Q){de.UndoMan.execute("Format","backcolor",Q=="default"?null:Q);de.cursor.setCursor(de.cursor.getCurrentCursorDesc())});$j("#swToolboxContent").dialog({title:"~Seaweed~ toolbox",resizable:false,autoOpen:t(),width:510,minHeight:0,position:swwpInfo.tb_sp.split("-"),open:function(){m.fireEvent("ToolboxOpenStateChanged",true)},close:function(){m.fireEvent("ToolboxOpenStateChanged",false)},dragStop:function(){var Q=de.getDocumentScrollPos();m.yOffset=m.dialogPane.offsetTop-Q.top;m.xOffset=m.dialogPane.offsetLeft-Q.left}});var M=O.parentNode;M.id="swToolbox";this.dialogPane=M;$j(M).addClass("sw-protect").addClass("sw-toolbox").css("position",a?"fixed":"absolute").css("opacity",swwpInfo.tb_op);if(swwpInfo.tb_sol){m.setVisible(true)}else{de.UndoMan.addObserver({onBeforeExec:function(){m.setVisible(true);de.UndoMan.removeObserver(this)}})}de.UndoMan.addObserver({onBeforeExec:this.onBeforeAction,onBeforeUndo:this.onBeforeAction,onBeforeRedo:this.onBeforeAction,onAfterExec:this.onAfterAction,onAfterUndo:this.onAfterAction,onAfterRedo:this.onAfterAction},this,1);de.selection.addObserver(this);$j(O).find(".ww-button:not(.sw-colorsel-arrow, .sw-colorsel-apply)").click(function(){if(!$j(this).hasClass("ui-state-disabled")){m["on"+this.id.charAt(2).toUpperCase()+this.id.substr(3)+"Click"]()}});function J(){K+='<div class="ww-buttonset ui-helper-clearfix">'}function P(){K+="</div>"}function L(R,Q,S){S=S||(R.charAt(0).toUpperCase()+R.substr(1));K+='<a id="sw'+R+'" class="ww-button ui-state-default'+(Q?" ui-corner-"+Q:"")+'" title="'+S+'"><span class="ww-icon ww-icon-'+R+'"></span></a>'}function N(){K+='<span class="ww-seperator"></span>'}},setVisible:function(J){if(J){$j("#swToolboxContent").dialog("open");this.repositionPanel();this.synchGUI()}else{$j("#swToolboxContent").dialog("close")}},isVisible:function(){return $j("#swToolboxContent").dialog("isOpen")},repositionPanel:function(){if(this.isVisible()){var J=de.getViewPortSize(1);var L=this.dialogPane.offsetTop,K=this.dialogPane.offsetLeft;if(a){if(L>=J.height){L=J.height-100}if(L<0){L=0}if(K>=J.width){K=J.width-100}if(K<0){K=0}}else{var M=de.getDocumentScrollPos();L=M.top+this.yOffset;K=M.left+this.xOffset}$j(this.dialogPane).css("top",L+"px").css("left",K+"px")}},onBeforeAction:function(J){this.execActionData=J},onAfterAction:function(){if(!this.lastSynchEditable||(this.execActionData&&this.execActionData.name!="InsertText"&&this.execActionData.name!="RemoveText")){this.synchGUI()}this.execActionData=0},onSelectionChanged:function(){if(!this.execActionData){this.synchGUI()}},synchGUI:function(){if(!this.isVisible()){return}var P=de.selection.isRangeEditable(),N,M,X;this.lastSynchEditable=P;if(P){var L=de.cursor.getCurrentCursorDesc();if(L){var O=de.doc.getEditSectionContainer(L.domNode);X=$j(O).hasClass("editable-postContent")||$j(O).hasClass("editable-newContent");var ab=de.doc.getEditProperties(O);if(ab){N=ab.afRE?ab.afRE:0;M=ab.afInclusive?true:false}}}this.setEnableState("swundo",de.UndoMan.hasUndo());this.setEnableState("swredo",de.UndoMan.hasRedo());var ac=de.selection.getEditState(["bold","italics","strike","underline","fontfamily","fontsize","link"]);var ae=ac.formatStates;this.setPressedState("swbold",ae.bold===true);this.setEnableState("swbold",P&&Q("formatbold"));this.setPressedState("switalic",ae.italics===true);this.setEnableState("switalic",P&&Q("formatitalics"));this.setPressedState("swunderline",ae.underline===true);this.setEnableState("swunderline",P&&Q("formatunderline"));this.setPressedState("swstrikethrough",ae.strike===true);this.setEnableState("swstrikethrough",P&&Q("formatstrike"));var V=Q("textalign");this.setPressedState("swjustifyleft",ac.textAlign=="left");this.setEnableState("swjustifyleft",P&&V);this.setPressedState("swjustifycenter",ac.textAlign=="center");this.setEnableState("swjustifycenter",P&&V);this.setPressedState("swjustifyright",ac.textAlign=="right");this.setEnableState("swjustifyright",P&&V);this.setPressedState("swjustifyfull",ac.textAlign=="justify");this.setEnableState("swjustifyfull",P&&V);this.formatCombo.setText(c[ac.inlineContainerType||""]?c[ac.inlineContainerType||""].name:"Format");this.setEnableState(this.formatCombo.button.id,P&&Q("changecontainer"));var S=ae.fontfamily;if(!S){S="mixed"}if(S!="mixed"){var W=null;for(var ad in u){var aa=u[ad].value.replace(/\s/g,"").replace(/\,/g,"").toLowerCase(),Z=S.replace(/\s/g,"").replace(/\,/g,"").toLowerCase();if(aa==Z){W=u[ad].name;break}}S=W||"mixed"}this.fontFamilyCombo.setText(S=="mixed"?"Font Family":S);this.setEnableState(this.fontFamilyCombo.button.id,P&&Q("formatfontfamily"));var U=ae.fontsize;if(!U){U="mixed"}this.fontSizeCombo.setText(U=="mixed"?"Font Size":U);this.setEnableState(this.fontSizeCombo.button.id,P&&Q("formatfontsize"));var J=Q("itemize"),T=Q("indent");this.setEnableState("swbullist",P&&J);this.setEnableState("swnumlist",P&&J);this.setEnableState("swindent",P&&T);this.setEnableState("swoutdent",P&&T);var R=Q("formatlink");this.setEnableState("swlink",P&&R);this.setEnableState("swunlink",P&&(ae.link?true:false)&&R);this.foreColorCombo.setEnabled(P&&Q("formatcolor"));this.backColorCombo.setEnabled(P&&Q("formatbackcolor"));this.setPressedState("swblockquote",ac.blockQuote);this.setEnableState("swblockquote",P&&Q("blockquote"));this.setEnableState("swpagebreak",P&&X);this.setEnableState("swwpimage",P&&X);this.setEnableState("swwpvideo",P&&X);this.setEnableState("swwpaudio",P&&X);var K=null;var L=de.cursor.getCurrentCursorDesc();if(L){var Y=L.domNode;while(Y&&de.doc.isNodeEditable(Y)){if(Y.nodeType==1&&!$j(Y).hasClass("dehighlight-node")){if(K){K="&nbsp;&#8594;&nbsp;"+K}else{K=""}K=Y.nodeName.toLowerCase()+K}Y=Y.parentNode}var ab=de.doc.getEditProperties(L.domNode);if(ab&&ab.name){if(K){K="&nbsp;&#8594;&nbsp;"+K}else{K=""}K="["+ab.name+"]"+K}if(!K){K="<em>unknown</em>"}}else{K="<em>none</em>"}$j("#swEditContext").html(K);function Q(af){return N?N.test(af.toLowerCase())==M:true}},setPressedState:function(K,J){if(J){$j("#"+K).addClass("ui-state-active")}else{$j("#"+K).removeClass("ui-state-active")}},setEnableState:function(K,J){if(J){$j("#"+K).removeClass("ui-state-disabled")}else{$j("#"+K).addClass("ui-state-disabled")}},onUndoClick:function(){de.UndoMan.undo()},onRedoClick:function(){de.UndoMan.redo()},onBoldClick:function(){if(de.selection.isRangeEditable()){de.UndoMan.execute("Format","bold",!de.selection.getEditState(["bold"]).formatStates.bold)}},onItalicClick:function(){if(de.selection.isRangeEditable()){de.UndoMan.execute("Format","italics",!de.selection.getEditState(["italics"]).formatStates.italics)}},onUnderlineClick:function(){if(de.selection.isRangeEditable()){de.UndoMan.execute("Format","underline",!de.selection.getEditState(["underline"]).formatStates.italics)}},onStrikethroughClick:function(){if(de.selection.isRangeEditable()){de.UndoMan.execute("Format","strike",!de.selection.getEditState(["strike"]).formatStates.strike)}},doJustify:function(J){if(de.selection.isRangeEditable()){de.UndoMan.execute("TextAlign",J)}},onJustifyleftClick:function(){this.doJustify("left")},onJustifyrightClick:function(){this.doJustify("right")},onJustifycenterClick:function(){this.doJustify("center")},onJustifyfullClick:function(){this.doJustify("justify")},onBullistClick:function(){if(de.selection.isRangeEditable()){de.UndoMan.execute("Itemize",true)}},onNumlistClick:function(){if(de.selection.isRangeEditable()){de.UndoMan.execute("Itemize",false)}},onIndentClick:function(){if(de.selection.isRangeEditable()){if(b()){de.UndoMan.execute("PromoteItem")}else{de.UndoMan.execute("Indent",true)}}},onOutdentClick:function(){if(de.selection.isRangeEditable()){if(b()){de.UndoMan.execute("DemoteItem")}else{de.UndoMan.execute("Indent",false)}}},onLinkClick:function(){j.show()},onUnlinkClick:function(){if(de.selection.isRangeEditable()){de.UndoMan.execute("Format","link",null)}},onBlockquoteClick:function(){if(de.selection.isRangeEditable()){de.UndoMan.execute("Blockquote")}},onPagebreakClick:function(){var J=de.selection.getRange(true);if(J){var L=J.endNode?J.endNode:J.startNode;var K=de.doc.getEditSectionContainer(L);while(L&&L.parentNode!=K){L=L.parentNode}if(L){de.UndoMan.execute("InsertHTML",v,K,L,L.nodeType==3?L.nodeValue.length:1)}}},onWpimageClick:function(){h.show("image")},onWpvideoClick:function(){h.show("video")},onWpaudioClick:function(){h.show("audio")},onSpellClick:function(){var J=de.doc.getAllEditSections(),M=[];for(var K in J){var L=$j(J[K]).attr("className");if(L=="editable-postContent"||L=="editable-commentContent"||L=="editable-postTitle"||L=="editable-newTitle"||L=="editable-newContent"){M.push(J[K])}}if(M.length){d.markErrors(M)}}};B.push(m);function t(){return swwpInfo.view.indexOf("new-")==0}function p(){return swwpInfo.view.indexOf("single-")==0}function i(L){var K=de.findClassName(L,/^editable-post.+/);if(K){var J=(new RegExp("^"+K+"-(\\d+)$").exec(L.id))||(new RegExp("^"+K+"-(\\d+)-(\\d+)$").exec(L.id));if(J){return parseInt(J[1])}}return null}var g;(function(){var N="Failed to communicate changes to server";g={init:function(){de.model(this)},itemsPending:[],saveExisting:function(Q){de.selection.clear();var aa=[],V=[];for(var R in Q){var Z=Q[R];this.itemsPending.push(Z);de.Changes.clear(Z);this.fireEvent("Save",Z);var S=de.findClassName(Z,/^editable-comment.+$/);if(S){var T=new RegExp("^"+S+"-(\\d+)-(\\d+)$").exec(Z.id);if(T){var U=ab(parseInt(T[1]),parseInt(T[2]));if(de.findClassName(Z,/^editable-commentContent$/)){U.data.comment_content=de.spell.stripSpellWrapperHTML(K(Z.cloneNode(true)).innerHTML);U.eSections.push(Z)}else{if(de.findClassName(Z,/^editable-commentAuthor$/)){U.data.comment_author=$j(K(Z.cloneNode(true))).text();U.data.comment_author_url=$j(Z).find("a").attr("href")||"";U.eSections.push(Z)}}}}var X=i(Z);if(X!==null){var Y=W(X);if(de.findClassName(Z,/^editable-postTitle$/)){Y.data.post_title=$j(K(Z.cloneNode(true))).text();Y.eSections.push(Z)}else{if(de.findClassName(Z,/^editable-postContent$/)){Y.data.post_content=de.spell.stripSpellWrapperHTML(M(Z));Y.eSections.push(Z)}}}}function ab(ac,ad){for(var ae in aa){if(aa[ae].data.post_id==ac&&aa[ae].data.comment_id==ad){return aa[ae]}}aa.push({data:{post_id:ac,comment_id:ad},eSections:[]});return aa[aa.length-1]}function W(ac){for(var ad in V){if(V[ad].data.post_id==ac){return V[ad]}}V.push({data:{post_id:ac},eSections:[]});return V[V.length-1]}for(var R in aa){P(aa[R].data,aa[R].eSections,true)}for(var R in V){P(V[R].data,V[R].eSections,false)}},saveNewPost:function(R){de.selection.clear();de.Changes.clear();this.itemsPending.push(R);var Q={post_content:de.spell.stripSpellWrapperHTML(M(document.getElementById("editableNewContent"))),post_title:$j(K(document.getElementById("editableNewTitle").cloneNode(true))).text(),post_status:R?"publish":"draft",post_type:swwpInfo.view.indexOf("page")!=-1?"page":"post"};if(swwpInfo.newPID){Q.post_id=swwpInfo.newPID}if(swwpInfo.view.indexOf("page")==-1){$j.extend(Q,{tags_input:$j("#swNewTags").val().replace(/\n\r/,","),post_excerpt:$j("#swExcerpt").val(),post_new_categories:$j("#swNewCatagories").val().replace(/\n\r/,","),post_existing_categories:""});var S=/^swcat(\d+)$/;$j(".swNewPostMeta input:checked").each(function(){if(this.id){var T=S.exec(this.id);if(T){Q.post_existing_categories+=(Q.post_existing_categories?",":"")+T[1]}}})}if(R){r.show("Publishing "+Q.post_type+"...","(You will be redirected to the "+Q.post_type+" once published)")}else{this.fireEvent("Save",R)}O("savepost",Q,function(W){g.itemsPending=[];var U=wpAjax.parseAjaxResponse(W,W.response,W.element),V=null;if(U){for(var T in U.responses){var Y=U.responses[T];if(Y.what=="error"){V=Y.data;break}}if((!U.responses||U.responses.length==0)&&(!V)){V="Server communicated invalid responce"}}else{V="Server communicated invalid responce"}if(V){de.Changes.dirty();if(R){r.error(V)}else{g.fireEvent("SaveFailed",null,V)}}else{if(R){I=1;var X=swwpInfo.siteURL+"/?p="+U.responses[0].id;$j("#swSkeletonContent").html('<em style="text-align:centre">You are being redirected. <a href="'+X+'">Click here</a> if redirect fails</em>');window.location=X}else{swwpInfo.newPID=U.responses[0].id;g.fireEvent("SaveSucceeded",null)}}},function(){de.Changes.dirty();g.itemsPending=[];if(R){r.error(N)}else{g.fireEvent("SaveFailed",null,N)}})},deletePost:function(){if(!t()&&!p()){return}var R=t()?"Draft":(swwpInfo.view.indexOf("post")!=-1?"Post":"Page"),Q;if(t()){Q=swwpInfo.newPID}else{$j(".editable-postContent").each(function(){Q=i(this);return false});if(!Q){alert("Unable to delete post: could not find editable sections");return}}q.show("Are you sure you want to delete this "+R+"?",function(){r.show("Deleting "+R+"...","(You will be redirected to your blog home once deleted)");if(t()&&!swwpInfo.newPID){window.location=swwpInfo.siteURL+"/"}else{O("deletepost",{post_id:Q},function(V){var T=wpAjax.parseAjaxResponse(V,V.response,V.element),U=null;if(T){for(var S in T.responses){var W=T.responses[S];if(W.what=="error"){U=W.data;break}}if((!T.responses||T.responses.length==0)&&(!U)){U="Server communicated invalid responce"}}else{U="Server communicated invalid responce"}if(U){r.error(U)}else{I=1;window.location=swwpInfo.siteURL+"/"}},function(){r.error("Failed to communicate with server")})}})}};function K(Q){$j(Q).find(".sw-mn-ph, .sw-es-ph").replaceWith("&nbsp;");return Q}function L(Q){for(var R in g.itemsPending){if(g.itemsPending[R]==Q){g.itemsPending.splice(parseInt(R),1)}}}function J(R){for(var Q in R){L(R[Q]);de.Changes.dirty(R[Q]);g.fireEvent("SaveFailed",R[Q],N)}}function O(R,S,T,Q){$j.ajax({type:"POST",url:swwpInfo.plugURL+"/php/ajax-action.php",data:$j.extend({_ajax_nonce:swwpInfo.nonce,action:R},S),success:T,error:Q})}function P(S,R,Q){O(Q?"savecomment":"savepost",S,function(W){for(var U in R){L(R[U])}var T=wpAjax.parseAjaxResponse(W,W.response,W.element),V=null;if(T){for(var U in T.responses){var X=T.responses[U];if(X.what=="error"){V=X.data;break}}if((!T.responses||T.responses.length==0)&&(!V)){V="Server communicated invalid responce"}}else{V="Server communicated invalid responce"}if(V){for(var U in R){de.Changes.dirty(R[U]);g.fireEvent("SaveFailed",R[U],V)}}else{for(var U in R){g.fireEvent("SaveSucceeded",R[U])}}},function(){J(R)})}function M(V){function W(Z){return document.createComment("_SWWP_SC:"+Z)}V=V.cloneNode(true);$j(V).find(".swwp-more").replaceWith(document.createComment("more"));$j(V).find(".swwp-shortcode").each(function(){var aa=$j(this).find(".swwp-sc-start");if(aa.length>0){var Z;aa.contents().each(function(){if(this.nodeType==8){Z=this;return false}});if(Z){$j(this).replaceWith(W(Z.nodeValue));return}}$j(this).remove()});$j(V).find(".wp-caption, .caption").each(function(){var af=this.id,ae=de.findClassName(this,/^align.+$/)||"alignnone",Z,ac,ab,ad=$j(this).text();$j(this).find("img").each(function(){Z=parseInt(this.width||this.style.width||(""+this.offsetWidth));ac=this;$j(this).attr("alt",ad);return false});if(!ac){$j(this).replace(document.createTextNode($j(this).text()));return}$j(ac).parents("a").each(function(){ab=this;return false});var aa=ac;if(ab){aa=ab.cloneNode(false);$j(ac).remove();aa.appendChild(ac)}$j(this).replaceWith(W("[caption "+(af?'id="'+af+'" ':"")+'align="'+ae+'" width="'+Z+'" caption="'+ad+'"]'+de.getOuterHTML(aa)+"[/caption]"))});$j(V).find("style").each(function(){if(/#gallery/g.test($j(this).text())){$j(this).remove()}});$j(V).find(".swwp-gallery").each(function(){var Z=this.title;if(Z&&/gallery\s.+/.test(Z)){Z=Z.substr(7)}else{Z=""}$j(this).replaceWith(W("[gallery"+Z+"]"))});K(V);var Q="",R=V.innerHTML,X=new RegExp("\\[(\\~|\\+)?\\s*(\\w+?)\\b.*?\\/?\\]"),Y;while(Y=X.exec(R)){Q+=R.substr(0,Y.index);R=R.substr(Y.index+Y[0].length);var S=new RegExp("\\[\\/"+Y[2]+"\\]"),U,T;if(U=S.exec(R)){T=Y[0]+R.substr(0,U.index+U[0].length);R=R.substr(U.index+U[0].length)}else{T=Y[0]}if(Y[1]){T="["+T.substr(2)}else{T="["+T+"]"}Q+=T}return Q+R}})();B.push(g)})();
